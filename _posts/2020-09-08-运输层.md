---
layout:     post                    # 使用的布局（不需要改）
title:       运输层                # 标题 
subtitle:                           #副标题
date:       2020-09-08              # 时间
author:     ONLYUNIVERSE            # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    Computer Network
---

### 协议概述

#### 端口

运输层使用协议端口号(端口)区分不同主机的不同进程;不同的主机上同一个端口号所表示的进程没有关联

运输层的抽象协议端口是软件端口,是应用层的各种不同协议进程与运输实体进行交互的地址

### UDP

#### 概述

* UDP是无连接的,无论是发送数据之前或是结束

* 尽最大努力交付

* UDP面向报文:即只在交付的报文前加上UDP首部

* 没有拥塞控制:即允许丢失一些数据,不允许太大的时延

#### 首部格式

![ ](https://wx1.sbimg.cn/2020/09/08/96Fsd.png)

* 源端口: 指定是否需要对方回信

* 目的端口: 终点交付报文

* 长度: UDP数据报的长度

* 检验和: 检测传输的数据是否出错

### TCP

* TCP是面向连接的运输层协议,通信前须建立连接,结束后释放

* TCP连接是点对点的连接

* TCP是可靠交付的服务

* 面向字节流:指每次TCP传输并不一定是完整的

#### TCP的连接

* 套接字:端口号和IP地址拼接而成,是TCP连接的端点

每条TCP连接唯一地被通信两端的两个断电所确定

### 可靠传输的工作原理

#### 停止等待协议

即每次发送方发送一个分组后等待对方的响应,再发送下一个分组

若接收方接收到有差错的分组,则丢弃,一段时间后发送方没有收到响应,则重发该组

若接收方的响应丢失,则接收方须在发送方重传后再次发送响应

#### 连续ARQ协议

发送方将连续N个分组连续发出,然后等待接收方的响应,当接收方确认前S个分组都接收到了,发送方就继续发送

### TCP报文首部

![ ](https://wx1.sbimg.cn/2020/09/08/9GWjI.png)

16位端口号：标示该段报文来自哪里（源端口）以及要传给哪个上层协议或应用程序（目的端口）。进行tcp通信时，一般client是通过系统自动选择的临时端口号，而服务器一般是使用知名服务端口号或者自己指定的端口号。

32位序号：表示本报文段的第一个数据字节在整个字节流中的位置序号

32位确认号：用作对另一方发送的tcp报文段的响应。其值是收到对方的tcp报文段的序号值＋1。假定主机A和B进行tcp通信，那么A发出的tcp报文段不但带有自己的序号，也包含了对B发送来的tcp报文段的确认号。反之也一样。

4位头部长度：表示tcp头部有多少个32bit字（4字节），因为4位最大值是15，所以最多有15个32bit，也就是60个字节是最大的tcp头部长度。

6位标志位：
URG：紧急指针是否有效,置一代表有效,有紧急数据,优先级高
ACK：表示确认号是否有效，携带ack标志的报文段也称确认报文段
PSH：提示接收端应用程序应该立即从tcp接受缓冲区中读走数据，为后续接收的数据让出空间
RST：表示要求对方重建连接。带RST标志的tcp报文段也叫复位报文段
SYN：表示建立一个连接，携带SYN的tcp报文段为同步报文段
FIN标志：表示告知对方本端要关闭连接了。

16为窗口大小：是TCP流量控制的一个手段，这里说的窗口是指接收通告窗口，它告诉对方本端的tcp接收缓冲区还能容纳多少字节的数据，这样对方就可以控制发送数据的速度。

16为校验和：由发送端填充，接收端对tcp报文段执行CRC算法以检验TCP报文段在传输过程中是否损坏。注意这个校验不仅包括tcp头部，也包括数据部分。这也是tcp可靠传输的一个重要保障。

16位紧急指针：是一个正的偏移量。它和序号字段的值相加表示最后一个紧急数据的下一字节的序号。因此这个字段是紧急指针相对当前序号的偏移量。不妨称之为紧急偏移，发送紧急数据时会用到这个。

TCP头部选项：最后一个选项字段是可变长的可选信息，最多包含40字节的数据。
