---
layout:     post                    # 使用的布局（不需要改）
title:       进程                   # 标题 
subtitle:                           #副标题
date:       2020-03-07              # 时间
author:     ONLYUNIVERSE            # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    C#
---

### 线程与进程

进程是资源调度和分配的基本单位
线程是程序执行的最小单位
相对于进程，线程的切换代价较小，于是可以在一个进程中同时运行多个线程
进程之间相互独立，同一进程下的各个线程之间共享程序的内存空间和其他资源
主线程可以调用CPU，而进程没有这样的权限

### C#中的相关类

System.Environment类中的ProceddorCount方法获取本机可用逻辑内核的数量

```C#
using System.Diagnostics;
//...
Process p = new Process();//创建Process组件的实例
p.StartInfo.FileName="文件名(notepad)";//启动指定程序名//首先在当前目录下寻找满足参数的程序，然后是在PATH路径下的程序//如果程序不在以上目录，则必须使用@+绝对路径
p.StartInfo.Arguments="参数(1.txt)";
p.Start();//启动线程

Process[] p1 =Process.GetProcesses();//获取本地计算机的所有进程
Process[] p2 =Process.GetProcessesByName("进程名");//获取指定的进程
```

## 任务管理器实例

```C#
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace _20200309
{
    /// <summary>
    /// MainWindow.xaml 的交互逻辑
    /// </summary>
    public partial class MainWindow : Window
    {
        int fileIndex = 1;
        string fileName = "Notepad";
        List<Data> list = new List<Data>();//泛型列表//Data是一个类
        public MainWindow()
        {
            InitializeComponent();
        }
        private void RefreshProcessInfo()//刷新
        {
            dataGrid1.ItemsSource = null;
            list.Clear();//清空
            Process[] processes = Process.GetProcesses();//获取所有进程
            // Process[] processes = Process.GetProcessesByName(fileName);
            // string FileName = "";
            foreach (Process p in processes)
            {
                Data data = new Data();
                data.Id = p.Id;
                data.ProcessName = p.ProcessName;
                try
                {
                    data.FileName = p.MainModule.FileName;
                }
                catch (Exception)
                {
                    data.FileName = "";//异常处理
                }
                list.Add(data);
            }
            dataGrid1.ItemsSource = list;
        }
        private void StartBtn_Click(object sender, RoutedEventArgs e)
        {
            string argument = Environment.CurrentDirectory + "\\myfile" + (fileIndex++) + ".txt";
            if (File.Exists(argument) == false)
            {
                File.CreateText(argument);//创建一个文本文档
            }
            Process p = new Process();
            p.StartInfo.FileName = fileName;
            p.StartInfo.Arguments = argument;
            p.StartInfo.UseShellExecute = false;
            p.StartInfo.WindowStyle = ProcessWindowStyle.Normal;
            p.Start();
            p.WaitForInputIdle();
            RefreshProcessInfo();
        }
        private void StopBtn_Click(object sender, RoutedEventArgs e)
        {
            var a = dataGrid1.SelectedItem;
            Data selectItem = a as Data;
            Process p = Process.GetProcessById(selectItem.Id);
            try
            {
                p.Kill();
            }
            catch(Exception)
            {
                throw;
            }
            RefreshProcessInfo();
        }
    }
    public class Data
    {
        public int Id { get; set; }
        public string ProcessName { get; set; }
        public string TotalMemory { get; set; }
        public string StartTime { get; set; }
        public string FileName { get; set; }
    }
}
```