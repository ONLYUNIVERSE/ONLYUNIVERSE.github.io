---
layout:     post                    # 使用的布局（不需要改）
title:       进程与线程                # 标题 
subtitle:                           #副标题
date:       2020-09-15              # 时间
author:     ONLYUNIVERSE            # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    OperatingSystem
---

### 进程

进程就是正在执行程序的实例

CPU在多个运行的进程之间不断切换，在宏观看来，每个进程都分配到一个虚拟CPU

进程创建后，父进程与子进程有不同的地址空间，在一个进程中修改的数据不会影响另一个进程

#### 进程的创建

在大部分复杂的系统中,需要某种方法创建或撤销线程

* 系统初始化

启动操作系统时，通常会创建若干进程，以完成所需的任务

* 正在运行的程序执行了创建进程的系统调用

在所从事的工作能够划分为多个不会互相影响的的进程时，创建进程能够有更好的工作效率

* 用户请求创建一个新进程

在某些系统中，用户能够同时开启多个进程，并与某进程进行交互

* 一个批处理作业的初始化

多在大型机的批处理系统应用

####　进程的终止

* 正常退出

* 出错退出

* 严重错误

* 被杀死

#### 进程的层次结构

某些进程自身被创建后，又可以创建新的子进程

在UNIX中，启动映像运行一个init程序，init命令再创建登录相关的进程，用户通过登录输入在终端的命令又启动了更多的进程

在Windows中，没有进程层次的概念，所有的进程地位是相同的；父进程在创建子进程的过程中会得到一个令牌(句柄)，得到令牌的进程可以控制特定子进程

#### 进程的状态

* 运行态：CPU空闲，没有被阻塞

* 就绪态：CPU空闲，但CPU资源没有分配给进程

* 阻塞态：由于输入或其他外部条件未就位，即使CPU空闲，进程也不能运行

#### 进程的实现

操作系统维护着进程表

进程表中保存着处于就绪态或阻塞态的进程的信息和其他维持系统正常运行的文件，保证进程可以随时继续启动

一旦发生中断，中断硬件就将多个存有中断信息的寄存器压入堆栈，再跳转至指示的位置

### 线程

线程是计算机操作系统能够调用的最小单位，是进程的实际运作单位

当存在大量的计算或其他需要处理的任务时将不同的琐碎任务交由多个小的进程完成是有益的

线程在进程中运行，共享系统分配给进程的资源；也可以申请独占资源

每一个线程都拥有自己的堆栈，用以存储相应过程中产生的局部变量和执行历史等(上下文)

####　在用户空间内实现线程

计算机拥有虚拟内存，将虚拟内存空间分为两部分，一部分划分给操作系统的内部核心程序，称为内核空间；另一部分划给各个进程，称为用户空间

在用户空间内调用各个线程，可以通过线程表迅速完成对线程的阻塞，启动或转换；由于这些操作都是在本地空间内完成的，不需要调用内核或是切换上下文，线程的调度十分快捷

阻塞系统调用带来的问题：若一个线程在被调用的过程中被阻塞了，不能及时读取到需要的输入，就会影响乃至停止其他线程；为了防止这类情况出现，使用*包装器*检查该线程的调用过程中是否安全，若可能被阻塞，则不调用该线程

线程独占CPU带来的问题：由于没有时钟中断，当一个线程不放弃CPU的独占时，该进程的其他线程就不能够运行

#### 在内核中实现线程

内核中拥有记录所有线程的线程表，希望进行调用的线程通过系统调用对线程表进行更新完成线程的创建和撤销

当一个进程阻塞时，内核根据某种规则，选择运行另一个线程或不运行

### 进程间通信

#### 竞争条件

不同的进程对同一资源进行修改，由于时钟中断和CPU调用时序，可能不同的进程对同一份变量的认识是不一样的

#### 临界区
